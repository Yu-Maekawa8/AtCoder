import os  # OSæ“ä½œç”¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆãƒ•ã‚©ãƒ«ãƒ€å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§å–å¾—ãªã©ï¼‰
import re  # æ­£è¦è¡¨ç¾ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆãƒ•ã‚©ãƒ«ãƒ€åã®å½¢å¼ãƒã‚§ãƒƒã‚¯ç”¨ï¼‰

# ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ã‚’ç”Ÿæˆã™ã‚‹ãƒ¡ã‚¤ãƒ³é–¢æ•°
def generate_progress(base_path='.', output_file='progress.md'):
    contests = []  # ã‚³ãƒ³ãƒ†ã‚¹ãƒˆã”ã¨ã®çŠ¶æ…‹ãƒ»é€²æ—æƒ…å ±ã‚’ä¿å­˜ã™ã‚‹ãƒªã‚¹ãƒˆ

    # ãƒ•ã‚©ãƒ«ãƒ€ä¸€è¦§ã‚’èª¿ã¹ã€ABCã‚³ãƒ³ãƒ†ã‚¹ãƒˆã«è©²å½“ã™ã‚‹ã‚‚ã®ã‚’å‡¦ç†
    for folder in sorted(os.listdir(base_path)):
        if re.match(r"ABC\d{3}", folder, re.IGNORECASE):  # ãƒ•ã‚©ãƒ«ãƒ€åãŒ ABC123 ã®å½¢å¼ã‹åˆ¤å®š
            problems = ['a', 'b', 'c', 'd']  # å¯¾è±¡ã®å•é¡Œï¼ˆAã€œDï¼‰
            path = os.path.join(base_path, folder)  # ã‚³ãƒ³ãƒ†ã‚¹ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã®ãƒ•ãƒ«ãƒ‘ã‚¹
            files = os.listdir(path)  # ãã®ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’å–å¾—
            status = {}  # å„å•é¡Œã”ã¨ã®çŠ¶æ…‹ã‚’è¨˜éŒ²ï¼ˆâœ…, âŒ, ğŸš«ï¼‰

            for p in problems:
                # å•é¡Œåï¼ˆa, b, c, dï¼‰ã§å§‹ã¾ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã™ã¹ã¦æŠ½å‡º
                matched_files = [f for f in files if f.lower().startswith(p)]
                status[p] = 'ğŸš«'  # åˆæœŸçŠ¶æ…‹ï¼šæœªå®Ÿè£…

                # ãƒãƒƒãƒã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­ã§çŠ¶æ…‹ã‚’åˆ¤å®š
                for fname in matched_files:
                    full_path = os.path.join(path, fname)  # ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ãƒ«ãƒ‘ã‚¹
                    if os.path.getsize(full_path) == 0:
                        continue  # ç©ºãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆã¯ã€Œæœªå®Ÿè£…ã€ã®ã¾ã¾ã‚¹ã‚­ãƒƒãƒ—

                    if 'no' in fname.lower():
                        status[p] = 'âŒ'  # noãŒå«ã¾ã‚Œã¦ã„ã‚Œã°ã€ŒæœªACã€
                    else:
                        status[p] = 'âœ…'  # noãŒå«ã¾ã‚Œãšã€ä¸­èº«ãŒã‚ã‚‹ï¼ACæ¸ˆã¿
                        break  # âœ…ãŒå„ªå…ˆã•ã‚Œã‚‹ã®ã§ã€ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯èª¿ã¹ãªãã¦ã‚ˆã„

            # ã‚³ãƒ³ãƒ†ã‚¹ãƒˆå…¨ä½“ã®é€²æ—ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’åˆ¤å®š
            symbols = list(status.values())  # å„å•é¡Œã®è¨˜å·ã ã‘å–ã‚Šå‡ºã™
            if all(s == 'ğŸš«' for s in symbols):
                overall = 'âŒ›'  # å…¨éƒ¨æœªå®Ÿè£…ï¼ˆç©ºãƒ•ã‚¡ã‚¤ãƒ«ï¼‰â†’ æœªç€æ‰‹
            elif all(s == 'âœ…' for s in symbols):
                overall = 'âœ…'  # å…¨éƒ¨ACæ¸ˆã¿ â†’ å®Œäº†
            else:
                overall = 'ğŸ”„'  # ãã‚Œä»¥å¤– â†’ ä½œæ¥­ä¸­

            # ã‚³ãƒ³ãƒ†ã‚¹ãƒˆåã¨çŠ¶æ…‹ã€å•é¡Œã”ã¨ã®è¨˜å·ã‚’è¨˜éŒ²
            contests.append((overall, folder.upper(), status))

    # Markdownå½¢å¼ã§ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›ï¼ˆREADMEãªã©ã«è²¼ã‚Œã‚‹å½¢å¼ï¼‰
    lines = [
        "### å‡¡ä¾‹\n",
        "- ABCDå„å•é¡Œï¼š",
        "  - âœ… = ACæ¸ˆã¿",
        "  - âŒ = å®Ÿè£…æ¸ˆã¿ã ãŒæœªAC",
        "  - ğŸš« = æœªå®Ÿè£…",
        "",
        "- ã‚³ãƒ³ãƒ†ã‚¹ãƒˆã®çŠ¶æ…‹ï¼š",
        "  - âœ… å®Œäº†ï¼šAã€œDå•é¡Œã™ã¹ã¦è§£ç­”ï¼†æ•´ç†æ¸ˆ",
        "  - ğŸ”„ ä½œæ¥­ä¸­ï¼šä¸€éƒ¨å•é¡Œã®è§£ç­”ãƒ»æ•´ç†é€²è¡Œä¸­",
        "  - âŒ› æœªç€æ‰‹ï¼šãƒ•ã‚©ãƒ«ãƒ€ã®ã¿ä½œæˆæ¸ˆï¼ˆã¾ãŸã¯ã™ã¹ã¦ç©ºãƒ•ã‚¡ã‚¤ãƒ«ï¼‰",
        "",
        "| çŠ¶æ…‹ | ã‚³ãƒ³ãƒ†ã‚¹ãƒˆ | A | B | C | D |",
        "|------|------------|---|---|---|---|"
    ]

    # åé›†ã—ãŸã‚³ãƒ³ãƒ†ã‚¹ãƒˆæƒ…å ±ã‚’Markdownã®è¡Œã«å¤‰æ›
    for mark, name, status in contests:
        row = f"| {mark} | {name} | {status['a']} | {status['b']} | {status['c']} | {status['d']} |"
        lines.append(row)

    # æœ€çµ‚çš„ã« `progress.md` ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦æ›¸ãå‡ºã™
    with open(os.path.join(base_path, output_file), 'w', encoding='utf-8') as f:
        f.write('\n'.join(lines))  # æ”¹è¡Œã§çµåˆã—ã¦ä¿å­˜

# ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒç›´æ¥å®Ÿè¡Œã•ã‚ŒãŸã¨ãã®ã¿ generate_progress ã‚’å‘¼ã³å‡ºã™
if __name__ == "__main__":
    generate_progress()