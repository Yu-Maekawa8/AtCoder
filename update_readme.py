import os  # OSæ“ä½œç”¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆãƒ•ã‚©ãƒ«ãƒ€å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§å–å¾—ãªã©ï¼‰
import re  # æ­£è¦è¡¨ç¾ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆãƒ•ã‚©ãƒ«ãƒ€åã®å½¢å¼ãƒã‚§ãƒƒã‚¯ç”¨ï¼‰

# ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ã‚’ç”Ÿæˆã™ã‚‹ãƒ¡ã‚¤ãƒ³é–¢æ•°
def generate_progress(base_path='.', output_file='progress.md'):
    contests = []  # ã‚³ãƒ³ãƒ†ã‚¹ãƒˆã”ã¨ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆçŠ¶æ…‹ãƒ»åå‰ãƒ»å•é¡Œã”ã¨ã®é€²æ—ï¼‰ã‚’ä¿å­˜ã™ã‚‹ãƒªã‚¹ãƒˆ
    ac_counts = {'a': 0, 'b': 0, 'c': 0, 'd': 0, 'full': 0}  # Aã€œDã®ACæ•°ã¨ã€å…¨å®Œäº†ã‚³ãƒ³ãƒ†ã‚¹ãƒˆæ•°ã‚’é›†è¨ˆã™ã‚‹è¾æ›¸

    # ãƒ•ã‚©ãƒ«ãƒ€ä¸€è¦§ã‚’èª¿ã¹ã¦ã€ABCå½¢å¼ï¼ˆä¾‹: ABC123ï¼‰ã«ãƒãƒƒãƒã™ã‚‹ã‚‚ã®ã ã‘å‡¦ç†
    for folder in sorted(os.listdir(base_path)):
        if re.match(r"ABC\d{3}", folder, re.IGNORECASE):  # ãƒ•ã‚©ãƒ«ãƒ€åãŒABCå½¢å¼ã‹ã©ã†ã‹ã‚’åˆ¤å®š
            problems = ['a', 'b', 'c', 'd']  # å¯¾è±¡ã®å•é¡Œï¼šAã€œD
            path = os.path.join(base_path, folder)  # ã‚³ãƒ³ãƒ†ã‚¹ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã®ãƒ•ãƒ«ãƒ‘ã‚¹ã‚’ä½œæˆ
            files = os.listdir(path)  # ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’å–å¾—
            status = {}  # å„å•é¡Œã®é€²æ—çŠ¶æ…‹ã‚’è¨˜éŒ²ã™ã‚‹è¾æ›¸

            # å„å•é¡Œï¼ˆaã€œdï¼‰ã«ã¤ã„ã¦çŠ¶æ…‹ã‚’åˆ¤å®š
            for p in problems:
                matched_files = [f for f in files if f.lower().startswith(p)]  # è©²å½“ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŠ½å‡º
                status[p] = 'ğŸš«'  # åˆæœŸçŠ¶æ…‹ã¯ã€Œæœªå®Ÿè£…ã€

                for fname in matched_files:
                    full_path = os.path.join(path, fname)  # ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ãƒ«ãƒ‘ã‚¹ã‚’å–å¾—

                    if os.path.getsize(full_path) == 0:
                        continue  # ç©ºãƒ•ã‚¡ã‚¤ãƒ«ã¯æœªå®Ÿè£…ã¨ã—ã¦ã‚¹ã‚­ãƒƒãƒ—

                    if 'no' in fname.lower():
                        status[p] = 'âŒ'  # ãƒ•ã‚¡ã‚¤ãƒ«åã« "no" ã‚’å«ã‚€ â†’ å®Ÿè£…æ¸ˆã ãŒæœªAC
                    else:
                        status[p] = 'âœ…'  # ä¸­èº«ãŒã‚ã‚Š "no" ã‚’å«ã¾ãªã„ â†’ ACæ¸ˆã¿
                        break  # âœ… ãŒè¦‹ã¤ã‹ã£ãŸã‚‰ãã‚Œã‚’å„ªå…ˆã—ã¦çµ‚äº†

            symbols = list(status.values())  # çŠ¶æ…‹ï¼ˆâœ…, âŒ, ğŸš«ï¼‰ã®ä¸€è¦§ã‚’å–å¾—

            # ã‚³ãƒ³ãƒ†ã‚¹ãƒˆå…¨ä½“ã®é€²æ—ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’åˆ¤å®š
            if all(s == 'ğŸš«' for s in symbols):
                overall = 'âŒ›'  # å…¨éƒ¨æœªå®Ÿè£… â†’ æœªç€æ‰‹
            elif all(s == 'âœ…' for s in symbols):
                overall = 'âœ…'  # å…¨éƒ¨ACæ¸ˆã¿ â†’ å®Œäº†
                ac_counts['full'] += 1  # å…¨å®Œäº†ã‚³ãƒ³ãƒ†ã‚¹ãƒˆæ•°ã‚’åŠ ç®—
            else:
                overall = 'ğŸ”„'  # ä¸€éƒ¨è§£ç­”æ¸ˆã¿ â†’ ä½œæ¥­ä¸­

            # âœ…ã®æ•°ã‚’å•é¡Œã”ã¨ã«åŠ ç®—
            for p in problems:
                if status[p] == 'âœ…':
                    ac_counts[p] += 1

            # ã‚³ãƒ³ãƒ†ã‚¹ãƒˆã”ã¨ã®çµæœã‚’ä¿å­˜
            contests.append((overall, folder.upper(), status))

    # Markdownå‡ºåŠ›ç”¨ã®è¡Œã‚’æº–å‚™ï¼ˆå‡¡ä¾‹ãªã©ã‚’è¨˜è¼‰ï¼‰
    lines = [
        "### å‡¡ä¾‹\n",  # ã‚¿ã‚¤ãƒˆãƒ«
        "- ABCDå„å•é¡Œï¼š",
        "  - âœ… = ACæ¸ˆã¿",
        "  - âŒ = å®Ÿè£…æ¸ˆã¿ã ãŒæœªAC",
        "  - ğŸš« = æœªå®Ÿè£…",
        "",
        "- ã‚³ãƒ³ãƒ†ã‚¹ãƒˆã®çŠ¶æ…‹ï¼š",
        "  - âœ… å®Œäº†ï¼šAã€œDå•é¡Œã™ã¹ã¦è§£ç­”ï¼†æ•´ç†æ¸ˆ",
        "  - ğŸ”„ ä½œæ¥­ä¸­ï¼šä¸€éƒ¨å•é¡Œã®è§£ç­”ãƒ»æ•´ç†é€²è¡Œä¸­",
        "  - âŒ› æœªç€æ‰‹ï¼šãƒ•ã‚©ãƒ«ãƒ€ã®ã¿ä½œæˆæ¸ˆï¼ˆã¾ãŸã¯ã™ã¹ã¦ç©ºãƒ•ã‚¡ã‚¤ãƒ«ï¼‰",
        "",
        # ç¾åœ¨ã®ACçŠ¶æ³ï¼ˆAã€œDã€å…¨å®Œäº†ã‚³ãƒ³ãƒ†ã‚¹ãƒˆæ•°ï¼‰ã‚’è¿½åŠ è¡¨ç¤º
        f"- ç¾åœ¨ã®ACæ•°ï¼šA={ac_counts['a']} / B={ac_counts['b']} / C={ac_counts['c']} / D={ac_counts['d']} / å…¨å®Œäº†ã‚³ãƒ³ãƒ†ã‚¹ãƒˆ={ac_counts['full']}",
        "",
        # Markdownå½¢å¼ã®è¡¨ãƒ˜ãƒƒãƒ€ãƒ¼
        "| çŠ¶æ…‹ | ã‚³ãƒ³ãƒ†ã‚¹ãƒˆ | A | B | C | D |",
        "|------|------------|---|---|---|---|"
    ]

    # ã‚³ãƒ³ãƒ†ã‚¹ãƒˆã”ã¨ã®é€²æ—ã‚’Markdownè¡¨ã®è¡Œã¨ã—ã¦è¿½åŠ 
    for mark, name, status in contests:
        if mark == 'âŒ›':  # æœªç€æ‰‹ã®ã¨ãã¯ Aã€œD ã‚’ã€Œ-ã€ã§è¡¨ç¤º
            lines.append(f"| {mark} | {name} | - | - | - | - |")
        else:  # ãã‚Œä»¥å¤–ã¯é€šå¸¸é€šã‚Šè¡¨ç¤º
            lines.append(f"| {mark} | {name} | {status['a']} | {status['b']} | {status['c']} | {status['d']} |")

    # æœ€çµ‚çš„ã« progress.md ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜
    with open(os.path.join(base_path, output_file), 'w', encoding='utf-8') as f:
        f.write('\n'.join(lines))  # å„è¡Œã‚’æ”¹è¡Œã§çµåˆã—ã¦æ›¸ãè¾¼ã‚€

# ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒç›´æ¥å®Ÿè¡Œã•ã‚ŒãŸã¨ãã®ã¿å®Ÿè¡Œ
if __name__ == "__main__":
    generate_progress()